#registry:
#  image: "registry:2.0"
#  command: >
#  net: "host"
#  restart: "always"
#  volumes:
#    - "/vagrant/data:/vagrant/data"
#  environment:
#    REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /vagrant/data/registry
#    REGISTRY_HTTP_ADDR: 0.0.0.0:5000
#  ports:
#    - "5000:5000"
#  privileged: true
dnsmasq:
  image: "172.16.16.15:5000/dnsmasq-local"
  net: "host"
  restart: "always"
  volumes:
    - "/vagrant/data/dnsmasq/dnsmasq.conf.d:/etc/dnsmasq.conf.d"
    - "/vagrant/data/dnsmasq/tftpboot:/var/tftpboot"
#nginx:
#  image: "172.16.16.15:5000/nginx-local"
#  net: "host"
#  restart: "always"
#  volumes:
#    - "/vagrant/data/nginx:/etc/nginx"
#    - "/vagrant/data/static:/data"
configorator:
  image: "172.16.16.15:5000/configorator"
  net: "host"
  restart: "always"
  volumes:
    - "/vagrant/data/cloud-config-templates:/cloud-config-templates:ro"
  command: run web
    --port 80
    --template /cloud-config-templates
    --master 172.16.16.15
apiserver:
  image: "172.16.16.15:5000/kube-apiserver:0.18.2"
  command: >
    --etcd-servers=http://172.16.16.15:2379
    --insecure-bind-address=0.0.0.0
    --insecure-port=8080
    --logtostderr=true
    --service-cluster-ip-range=10.1.1.0/24
    --v=0
  net: "host"
  restart: "always"
  volumes:
    - "/vagrant/data/kubernetes:/etc/kubernetes"
    - "/vagrant/data/share/ca-certificates:/etc/ssl/certs"
    - "/vagrant/data/run/kubernetes:/var/run/kubernetes"
controllermanager:
  image: "172.16.16.15:5000/kube-controller-manager:0.18.2"
  command: >
    --logtostderr=true
    --master=http://172.16.16.15:8080
    --cloud-provider=""
    --v=0
  net: "host"
  restart: "always"
  volumes:
    - "/vagrant/data/kubernetes:/etc/kubernetes"
    - "/vagrant/data/share/ca-certificates:/etc/ssl/certs"
scheduler:
  image: "172.16.16.15:5000/kube-scheduler:0.18.2"
  command: >
    --master=http://172.16.16.15:8080
    --logtostderr=true
    --v=0
  net: "host"
  restart: "always"
  volumes:
    - "/vagrant/data/kubernetes:/etc/kubernetes"
    - "/vagrant/data/share/ca-certificates:/etc/ssl/certs"
register:
  image: "172.16.16.15:5000/kube-register:0.0.4"
  command: >
    --api-endpoint="http://172.16.16.15:8080"
    --fleet-endpoint="http://172.16.16.15:4002"
    --healthz-port="10255"
    --metadata="kube-role=node"
    --sync-interval=10
  net: "host"
  restart: "always"
